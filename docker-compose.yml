version: '3.8'
services:
  prycto-client:
    container_name: prycto-client
    image: 'node:14.15.1-alpine'
    command: npx lerna exec 'npm run start' --scope prycto-client
    depends_on:
      - prycto-server
    ports:
      - '3001:3000'
    user: node
    volumes:
      - './:/home/node/app'
    working_dir: /home/node/app

  prycto-server:
    container_name: prycto-server
    image: 'node:14.15.1-alpine'
    command: npx lerna exec 'npm run start' --scope prycto-server
    env_file:
      - ./prycto-server/.env
    depends_on:
      - mongo-prycto
      - redis-prycto
    ports:
      - '3002:3000'
    user: node
    volumes:
      - './:/home/node/app'
    working_dir: /home/node/app

  mongo-prycto:
    container_name: mongo-prycto
    image: 'mongo:4.4'
    ports:
      - '27019:27017'
    volumes:
      - 'mongo-data-prycto:/data/db'

  redis-prycto:
    container_name: redis-prycto
    image: redis
    restart: always
    ports:
      - 6377:6379

volumes:
  mongo-data-prycto: {}
